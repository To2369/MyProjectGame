<!--
UNIT06_LEARNING UNIT06 学習要項
SPRITE - TEXEL

<span style="color:#994433;border: 1px red solid; padding: 2px;font-size:100%;font-weight: bold;">

Texture space
Texel space
-->

# UNIT06 SPRITE - TEXEL 学習要項

---

## <span style="color:#334488;">Texture space</span>
#### <span style="color:#334488;">テクスチャ座標</span>

テクスチャ座標とは左上を 0,0 として右下を 1,1 とした座標です。
頂点データとして利用されます。

@import "images/テクスチャ座標.png"

UNIT06 では画像から一部分だけを描画するという事を行います。
例えば下記の画像から赤枠で囲った右下だけを描画したい場合、頂点データに設定する**テクスチャ座標**はどのように設定すれば良いのでしょうか？

@import "images/テクセル02.png"

テクスチャの左上が 0,0 で 右下が 1,1 なので設定するテクスチャ座標は

    {0.5f, 0.5f, 1.0f, 1.0f}

です。頂点データに対して上記の数値を設定することでテクスチャの一部分を切り取って描画することが可能になります。

では下記のような画像で右下を赤枠の画像を描画したい場合、どのように設定すれば良いでしょう？

@import "images/テクセル03.png"

これをテクスチャ座標で計算を行わずに設定するには勘にたよる以外ありません。
なので **テクセル座標** を利用します。

---

## <span style="color:#334488;">Texel space</span>
#### <span style="color:#334488;">テクセル座標</span>

テクセル座標は画像ファイルのサイズでの座標で、皆さんが画像ファイルを確認する際に普段よく見かけるサイズでもあります。
画像ファイルの左上を 0,0 として右下は画像ファイルのサイズに依存しています。

前回表示した下記の画像であれば

@import "images/cyberpunk.jpg"

    左上      0,   0
    右下    616, 353

になります。

画像ファイルを開いた際に詳細などにサイズとして表示されているサイズです。この座標系で画像ファイルを扱うのが普通です。

これをどのようにテクスチャ座標で指定するのか？

先ほど説明した下記の画像で考えてみましょう・・・といっても求めたいテクセル座標から全体のサイズを割るだけでテクスチャ座標は求まります。

@import "images/テクセル04.png"

赤枠の画像の左上の座標が **230,400** で右下の座標が **300,500**
画像全体のサイズが **300,500** なので

座標から全体のサイズを割ってテクスチャ座標を計算します。

---

$
テクセル座標系での左座標　/　テクセル座標系での画像幅　=　テクスチャ座標系での左座標\\
テクセル座標系での上座標　/　テクセル座標系での画像高さ　=　テクスチャ座標系での上座標\\
テクセル座標系での右座標　/　テクセル座標系での画像幅　=　テクスチャ座標系での右座標\\
テクセル座標系での下座標　/　テクセル座標系での画像高さ　=　テクスチャ座標系での下座標
$

$
230/300=0.76666666\\
400/500=0.8\\
300/300=1.0\\
500/500=1.0
$

この値を頂点データに設定することで赤枠の画像だけを描画することが出来ます。

---

ということで、やっていることも考え方も単純です。テクセル座標をテクスチャ座標に変換して頂点データに設定できるようになれるという事は、画像ファイルにある特定の画像だけをポリゴンに描画できるようになれるということです。

---

#### <span style="color:#334488;">サンプラーステート(アドレッシングモード)</span>

ちなみにテクスチャ座標に 1 以上や 1 以下を設定した場合はどうなるのでしょうか？
例えば下記のように 2 を設定したらどうなるのか？

    vertices[0].texcoord = { 0, 0 };
    vertices[1].texcoord = { 2, 0 };
    vertices[2].texcoord = { 0, 2 };
    vertices[3].texcoord = { 2, 2 };

これは、サンプラーステートに設定した、アドレッシングモードによって表示が変化します。
アドレッシングモードの設定を行ったのは framework の下記の部分です。

    // 左右に対してのアドレッシングモードの適用
    sampler_desc.AddressU = D3D11_TEXTURE_ADDRESS_WRAP;
    // 上下に対してのアドレッシングモードの適用
    sampler_desc.AddressV = D3D11_TEXTURE_ADDRESS_WRAP;
    // 奥行に対してのアドレッシングモードの適用
    sampler_desc.AddressW = D3D11_TEXTURE_ADDRESS_WRAP;

現在設定しているのは**ラップアドレスモード**です。

---

##### <span style="color:#334488;">ラップアドレスモード</span>

以下の画像はラップアドレスモードの使用例を示しています。

@import "images/ラップアドレッシングモード.png"

<span style="color:#334499; padding: 2px;font-size:80%;font-weight: bold;">
<br>
ラップアドレスモードではテクスチャ座標の整数部分は切り捨てられ単純に少数部分だけをテクスチャ座標として計算する。これを設定するとテクスチャ座標（3.25、3.75）は（0.25、0.75）になります。<br>
テクスチャ座標が負の場合は整数部分が切り捨てられたあと、１から差し引かれます。なので（-0.01、-2.25）は（0.99、0.75）になります。<br><br>
</span>

つまり描画する画像を繰り返し描画するという処理を行います。

---

##### <span style="color:#334488;">ミラーアドレスモード</span>

以下の画像はミラーアドレスモードの使用例を示しています。

@import "images/ミラーテクスチャアドレスモード.png"

黄色の線は、テクスチャ座標の整数境界を示しています。

<span style="color:#334499; padding: 2px;font-size:80%;font-weight: bold;">
ミラーアドレスモードでは、すべての整数境界でUV座標を反転します。[0 から 1] の範囲のテクスチャ座標は通常どおり処理されますが、[1 から 2] の範囲のテクスチャ座標は反転され（テクスチャ座標の小数部分を 1 で減算することにより）、テクスチャ範囲 [2 から 3]の座標は、再び正常に処理されます。<br><br>
</span>

つまり、単位 1.0 毎に反転した画像を表示するという処理を行います。

---

##### <span style="color:#334488;">クランプアドレスモード</span>

以下の画像はクランプアドレスモードの使用例を示しています。

@import "images/クランプアドレスモード.png"

<span style="color:#334499; padding: 2px;font-size:80%;font-weight: bold;">
クランプアドレスモードを使用すると、テクスチャ座標は [0 から 1] の範囲でクランプされます。
</span>

つまり 0 以下では 0 の座標の色がそのまま使用され、1 以上では 1 の座標の色がそのまま使用されるという処理をする。

---

##### <span style="color:#334488;">ボーダーアドレスモード</span>

以下の画像はボーダーアドレスモードの使用例を示しています。

@import "images/ボーダーアドレスモード.png"

<span style="color:#334499; padding: 2px;font-size:80%;font-weight: bold;">
テクスチャ座標が [0 から 1] の範囲外の場合、ボーダーアドレッシングモードでｗは指定された境界色を表示します。
</span>

これは説明そのままです。ボーダー色を設定する項目があり、そこに設定されている色が表示されるという事です。デフォルトは０なので黒になります。