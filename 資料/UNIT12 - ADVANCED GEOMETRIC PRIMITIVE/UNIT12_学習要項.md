<!--
UNIT12_LEARNING UNIT12 学習要項
ADVANCED GEOMETRIC PRIMITIVE

<span style="color:#994433;border: 1px red solid; padding: 2px;font-size:100%;font-weight: bold;"></span>

Rasterizer state
Wireframe
Cube
Cylinder
Sphere
Capsule
-->

# UNIT12_LEARNING ADVANCED GEOMETRIC PRIMITIVE 学習要項

---

## <span style="color:#334488;">Rasterizer state</span>
#### <span style="color:#334488;">ラスタライザステート</span>

ピクセルシェーダの前に実行される処理をラスタライザステージと呼びます。

ラスタライザステージでは頂点シェーダステージで処理された頂点や三角形のなどの画面をピクセルに変換するという事をしています。

ラスタライザステージは GPU 側で行うのですが、この処理は**ラスタライザステート**で制御を行います。

**ラスタライザステート**を設定することで三角形の裏面を描画しないようにしたり、ワイヤーフレームだけを描画したりできます。
ビューポートやシザー矩形などでレンダーターゲットに書き込む範囲を指定することもできます。

---

ラスタライザステートを利用するには以下の構造体を利用します。

    D3D11_RASTERIZER_DESC

この構造体には以下のメンバが含まれています。

|メンバ|詳細|
--|--
**FillMode**|三角形描画時の描画モードを指定するものになります。
**CullMode**|描画しない三角形の面の向きを指定します。三角形の面向きにより描画するかしないかを決めることをカリングと呼びます。 三角形の面向きは構成する頂点が時計回りか反時計回りかで決まります。<br>それだけだと表裏は決まりませんが、<br>下のFrontCounterClockwiseを使用することで決定します。
**FrontCounterClockwise**|三角形を構成する頂点が反時計回りの場合に表面とみなすかどうかを表すフラグになります。 trueなら反時計回りを表面に、falseなら時計回りを表面にします。
**DepthBias**<br>**DepthBiasClamp**<br>**SlopeScaledDepthBias**|深度バイアスを計算するときに使用する値になります。<br>度バイアスは同じ深度値があった場合の優先順位をつけるためのものになります。
**DepthClipEnable**|距離によるクリッピングを行うかのフラグになります。
**ScissorEnable**|シザー矩形カリングを行うかのフラグになります。 シザー矩形については下の方で説明します。
**MultisampleEnable**|マルチサンプリングアンチエイリアス(MSAA)のレンダーターゲットを使用している時、四辺形ラインアンチエイリアスを行うか、<br>アルファラインアンチエイリアスを行うかを決めるフラグになります。 
**AntialiasedLineEnable**|MSAAのレンダーターゲットを使用している時、<br>線分描画でMultisampleEnableがfalseのとき、アンチエイリアスを有効にします。

---

## <span style="color:#334488;">Wireframe</span>
#### <span style="color:#334488;">ワイヤーフレーム</span>

ラスタライザステートの **FillMode** に設定できる描画モードの１つです。
**FillMode** に対して以下の指定を設定することでポリゴンを**ワイヤーフレーム**で表示することが出来ます。

    D3D11_FILL_WIREFRAME

3D モデルの見えない部分を確認する時などに利用します。

下記はワイヤーフレームでカリングを true にして裏面を非表示にした状態です。

@import "images/ワイヤーフレーム裏面カリング.png"

#### <span style="color:#334488;">カリング</span>

カリングとはラスタライザステートの **CullMode** で設定できる項目で３角形の表面か裏面を表示するかしないかの設定の事です。**D3D11_CULL_NONE**(false)の場合は「裏表すべて表示する」になります。

どちらが表面でどちらが裏面なのかはラスタライザステートの **FrontCounterClockwise** によって指定します。
説明そのままで、三角形を構成する頂点が反時計回りの場合に表面とみなすかどうかを表すフラグになります。 trueなら反時計回りを表面に、falseなら時計回りを表面にします。

４つの頂点座標で４つの頂点インデックスを持った頂点データで２つの三角形で下記のような四角形を作ったとしましょう。

@import "images/インデックスバッファ02.png"

三角形を作る際に頂点インデックスを以下のように指定すると、

    {1,2,3},
    {1,2,4}

三角形が形作られる際には以下のように処理がおこなれています。

@import "images/カリング.png"

|頂点インデックス|処理された内容|
--|--
{1,2,3}|頂点インデックスが**時計回り**に処理された三角形
{1,2,4}|頂点インデックスが**反時計回り**に処理された三角形

この場合、**CullMode** を **D3D11_CULL_NONE** にした場合は四角形が表示されますが、以下の設定をそれぞれ行った場合どちらかの三角形が表示されなくなります。

|D3D11_CULL_MODE||
--|--
**D3D11_CULL_FRONT**|表面を非表示
**D3D11_CULL_BACK**|裏面を非表示

|FrontCounterClockwise のフラグ||
--|--
**TRUE**|反時計回りを表面
**FALSE**|時計回りを表面

#### これがどのようなことに利用できるのか？

上記の画像のワイヤーフレームになった立方体ですが

    3D モデルの見えない部分を確認する時などに利用します

と説明していますが、立方体の裏側のポリゴンは反時計回りになっているので、結局描画されていないのがわかります。
これでは確認できません。そこでカリングを無しにしてワイヤーフレームにすることで、

@import "images/ワイヤーフレームカリングなし.png"

ポリゴンの裏側から隅々まで確認ができるようになりました。

ただし、必要の無い部分を描画するという事はそれだけ処理が重くなるということなので、あくまでデバッグ用の確認の為であるという事を覚えておいてください。もちろん3Dの演出などでも利用はされています。

---

## <span style="color:#334488;">Cube</span>
#### <span style="color:#334488;">立方体</span>

基本的な幾何プリミティブ。3D のシンプルな当たり判定などにも利用できる。

正立方体に必要な点の数は８個。

１つの面で利用される頂点座標の数は？
２つの三角形を作るのに必要な頂点座標の数は４個。
正立方体の面は全部で６個あるので設定すべき頂点座標の数は

$
4*6 = 24
$

１つの面で利用される頂点インデックスの数は？
２つの三角形を作るのに必要な頂点インデックスの数は６個。
正立方体の面は全部で６個あるので設定すべき頂点インデックスの数は

$
6*6 = 36
$

頂点座標２４個と頂点インデックス３６個にそれぞれ値を設定して立方体を作ることが出来ます。

@import "images/立方体.png"
