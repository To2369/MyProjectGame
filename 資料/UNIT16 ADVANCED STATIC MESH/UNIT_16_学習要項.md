<!--
UNIT16_LEARNING UNIT16 学習要項
ADVANCED STATIC MESH

<span style="color:#994433;border: 1px red solid; padding: 2px;font-size:100%;font-weight: bold;"></span>

Phong shading
Specular reflection
Bump map
Normal mapping
Dummy texture
Bounding box
-->

# UNIT16_LEARNING ADVANCED STATIC MESH 学習要項


---

## <span style="color:#334488;">Phong shading</span>
#### <span style="color:#334488;">フォンシェーディング</span>

物体に直接あたる光を計算する局所照明モデルの１つを**フォン反射モデル**と呼び、これをシェーダーで表現する技法を**フォンシェーディング**と呼びます。

**フォン反射モデル**では、物体に直接あたる光を**拡散反射・鏡面反射・環境反射**の３つに分けて考えます。

@import "images/フォン反射モデル01.png"

拡散・鏡面・環境のそれぞれに対してどのように光を反射するのかを決めていくことで、物体の色や質感を表現していきます。

---

## <span style="color:#334488;">Specular reflection</span>
#### <span style="color:#334488;">鏡面反射</span>

ライティングの手法の１つで金属などツルツルした物体に光が当たると鏡のように光を反射します。正確に表現しようとすると計算量が膨大になってしまうので光源を点と考えハイライトを付ける事で似たような表現を再現します。
　反射する方向は光の当たった面に対して反対方向になります。この反射した光がどのくらいカメラに向かっているかを計算してハイライトを加えていきます。
　完全な鏡では正反射方向のみですが、ツルツルぐあいによって正反射を中心にした範囲に広がっていきます。見ている人の位置が正反射方向にある場合光がよく見え、それ以外の場合光はあまり見えません。**つまり鏡面反射の計算にはカメラの座標が必要になります。**

@import "images/鏡面反射01.png"

---

## <span style="color:#334488;">Bump map</span>
#### <span style="color:#334488;">バンプマップ</span>

一言で説明すると「凸凹を表現する」技術です。

レンダリングするオブジェクトの面の法線に対する揺らぎをハイトマップ（高低マップ）で調べて、光源計算の完了前に各ピクセルに対して適用する、CGの技術である。

モデルに通常のテクスチャとは別に高低の情報を持つハイトマップを指定することで、疑似的に影やハイライトを作り、メッシュで凸凹をつけていなくても見た目上の凸凹感を表現できる、というものです。

@import "images/バイトマップの仕組み01.png"

バンプマッピングのハイトマップにはグレースケール画像を利用します。
白が高い部分、黒が低い部分を表します。

@import "images/ハイトマップ01.png"

---

## <span style="color:#334488;">Normal mapping</span>
#### <span style="color:#334488;">法線マッピング</span>

法線情報を使うことでさらに細かな凹凸を表現することができます。
バンプマップでも高低差は表現できますが、実際は法線に応じてハイライトなどのかかり方が変わってきます。

ノーマルマッピングに使うノーマルマップ（法線マップ）には、以下のように水色、紫、ピンクという色が使われていることが多いです。

@import "images/ノーマルマップ01.png"

ハイトマップが高さの情報のみを保持するのに対し、ノーマルマップにはピクセル単位で面の向きがどちらを向いているか（法線ベクトル）というXYZの数値が色情報として格納されています。

**法線ベクトル**のX成分（-1.0~1.0）が赤（0~255）、Y成分が緑、Z成分が青に当たりますが、平面は常にZ+方向を向いているため、Z成分が強く基本的に青色に近くなるという仕組みです。

以下の通常の壁の画像に

@import "images/通常の描画01.png"

以下の法線マップを合わせることで、

@import "images/ノーマルマップ02.png"

以下のような凸凹が表現できます。

@import "images/法線マップによる描画01.png"

---

#### <span style="color:#334488;">法線ベクトル</span>

UNIT の始めの方からちらほら出てきている normal という成分で**頂点の向き**の事を指しており、ライティングの計算などに用いられます。

---

## <span style="color:#334488;">Dummy texture</span>
#### <span style="color:#334488;">ダミーテクスチャ</span>

現状の実装では Cube や Torus などマテリアルを持たないメッシュを読み込もうとするとテクスチャを読み込無段階で落ちてしまいます。

それを回避するためにダミーのテクスチャを設定してマテリアルを持たないメッシュでも問題なく読み込めるようにします。

---

## <span style="color:#334488;">Bounding box</span>
#### <span style="color:#334488;">バウンディングボックス</span>

オブジェクトの最大寸法または範囲を囲む最少のボックスでAABB(軸並行境界ボックス)とも呼ばれます。
衝突判定を行う際に無駄な計算を削減するためのアルゴリズムなどに用いられます。

AABBは xyz の各軸に平行な直方体で、軸に平行であるため、当たり判定の計算が非常に軽くなります。

ありがちな衝突アルゴリズムとして、複雑なメッシュ形状に対する衝突判定を行う際、メッシュ形状を包含するAABBを事前に定義し、まずAABBとの衝突判定（軽い計算）を行います。AABBと衝突している場合のみ、メッシュ形状に対する衝突判定（重たい計算）を行います。こうすることで、AABBに衝突しなかった場合は重たい計算は行わずに済みます。

@import "images/バウンディングボックス02.png"